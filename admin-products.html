<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin – Manage Products</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>

<script>
// Admin protection
if (!localStorage.getItem("gt_admin")) {
    window.location.href = "index.html";
}
</script>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg tron-navbar">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="admin.html">
            <img src="assets/images/logo.png" class="logo-icon me-2">
            <span class="brand-text">Admin Panel</span>
        </a>
    </div>
</nav>

<div class="tron-divider"></div>

<section class="women-section">
    <h2 class="section-title">Manage Products</h2>

    <div class="container">

        <div class="d-flex justify-content-end mb-3">
            <a href="admin-add-product.html" class="checkout-btn">+ Add New Product</a>
        </div>

        <div class="row mb-4">
    <div class="col-md-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
    </div>

    <div class="col-md-3">
        <select id="categoryFilter" class="form-select">
            <option value="">All Categories</option>
        </select>
    </div>

    <div class="col-md-3">
        <select id="activeFilter" class="form-select">
            <option value="">Active + Inactive</option>
            <option value="1">Active Only</option>
            <option value="0">Inactive Only</option>
        </select>
    </div>
</div>


        <table class="table table-dark table-striped table-bordered align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Price (£)</th>
                    <th>Category</th>
                    <th>Active</th>
                    <th style="width: 160px;">Actions</th>
                </tr>
            </thead>
            <tbody id="productTable"></tbody>
        </table>

    </div>
</section>

<footer class="tron-footer">
    <div class="footer-content">
        <p>© 2026 Galactic Threads</p>
    </div>
</footer>

<script>
let allProducts = [];

// Load all products
async function loadProducts() {
    const res = await fetch("/api/admin/products");
    allProducts = await res.json();
    renderProducts(allProducts);
}

// Render products into table
function renderProducts(products) {
    const table = document.getElementById("productTable");
    table.innerHTML = "";

    products.forEach(p => {
        table.innerHTML += `
            <tr>
                <td>${p.id}</td>
                <td>${p.name}</td>
                <td>£${p.price.toFixed(2)}</td>
                <td>${p.category || "Uncategorised"}</td>
                <td>${p.active ? "Yes" : "No"}</td>
                <td>
                    <a href="admin-edit-product.html?id=${p.id}" class="btn btn-sm btn-primary">Edit</a>
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">Delete</button>
                </td>
            </tr>
        `;
    });
}

// Load categories into filter dropdown
async function loadCategoryFilter() {
    const res = await fetch("/api/admin/categories");
    const categories = await res.json();

    const filter = document.getElementById("categoryFilter");

    categories.forEach(cat => {
        filter.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
    });
}

// Apply search + filters
function applyFilters() {
    const search = document.getElementById("searchInput").value.toLowerCase();
    const category = document.getElementById("categoryFilter").value;
    const active = document.getElementById("activeFilter").value;

    let filtered = allProducts.filter(p => {
        const matchesSearch =
            p.name.toLowerCase().includes(search) ||
            (p.category && p.category.toLowerCase().includes(search)) ||
            p.price.toString().includes(search);

        const matchesCategory =
            category === "" || p.category === category;

        const matchesActive =
            active === "" || p.active.toString() === active;

        return matchesSearch && matchesCategory && matchesActive;
    });

    renderProducts(filtered);
}

// Delete product
async function deleteProduct(id) {
    if (!confirm("Are you sure you want to deactivate this product?")) return;

    const res = await fetch(`/api/admin/product/${id}`, {
        method: "DELETE"
    });

    const data = await res.json();
    alert(data.message);
    loadProducts();
}

// Event listeners for live filtering
document.getElementById("searchInput").addEventListener("input", applyFilters);
document.getElementById("categoryFilter").addEventListener("change", applyFilters);
document.getElementById("activeFilter").addEventListener("change", applyFilters);

// Initialise
loadProducts();
loadCategoryFilter();
</script>


</body>
</html>
